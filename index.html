<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Peng"><title>Peng'Blog</title><meta name="description" content="Welcome to my blog"><meta name="keywords" content="Blog,博客,Hexo"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/avatar.jpg"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="page-top animated fadeInDown"><div class="nav"><li> <a class="current" href="/">首页</a></li><li> <a href="/archives">归档</a></li><li> <a href="/tags">标签</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)" style="display:none;"> </a></li><li><a class="fa fa-search" onclick="openWindow();"></a></li></div><div class="avatar"><img src="/images/avatar.jpg"></div></div></div><div class="sidebar animated fadeInDown"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/avatar.jpg" style="width:220px;" alt="favicon"><h3 title=""><a href="/">Peng'Blog</a></h3><div class="description"><p>Welcome to my blog</p></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/AnderPeng"><i class="fa fa-github"></i></a></li><li><a href="mailto:365520067@qq.com"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="http://sighttp.qq.com/authd?IDKEY=365520067"><i class="fa fa-qq"></i></a></li></ul></div></div><div class="footer"><div class="beian"></div></div></div><div class="main"><div class="autopagerize_page_element"><div class="content"><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/02/24/jenkinks/">Docker&amp;Jenkins 自动化部署项目流程</a></h3></div><div class="post-content"><div class="card"><p><h3 id="1-安装Docker（本文采用宝塔面板安装的，不做过多阐述）"><a href="#1-安装Docker（本文采用宝塔面板安装的，不做过多阐述）" class="headerlink" title="1. 安装Docker（本文采用宝塔面板安装的，不做过多阐述）"></a>1. 安装Docker（本文采用宝塔面板安装的，不做过多阐述）</h3><h3 id="2-下载Jenkins镜像"><a href="#2-下载Jenkins镜像" class="headerlink" title="2. 下载Jenkins镜像"></a>2. 下载Jenkins镜像</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull jenkins/jenkins:lts        //lts表示支持版本较长</span><br></pre></td></tr></table></figure>

<p><img src="/../images/jenkins/Snipaste_2023-02-24_10-09-29.png" alt="Snipaste_2023-02-24_10-09-29"></p>
<h3 id="3-创立jenkins挂载目录并赋权限"><a href="#3-创立jenkins挂载目录并赋权限" class="headerlink" title="3. 创立jenkins挂载目录并赋权限"></a>3. 创立jenkins挂载目录并赋权限</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /www/jenkins_home</span><br><span class="line">chown -R 1000 /www/jenkins_home/</span><br></pre></td></tr></table></figure>

<h3 id="4-创立并启动Jenkins容器"><a href="#4-创立并启动Jenkins容器" class="headerlink" title="4. 创立并启动Jenkins容器"></a>4. 创立并启动Jenkins容器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=jenkins -p 8080:8080 -v  /www/jenkins_home:/var/jenkins_home jenkins/jenkins:lts</span><br><span class="line"></span><br><span class="line">-d 标识是让 docker 容器在后盾运行</span><br><span class="line">-p 10240:8080 将镜像的8080端口映射到服务器的10240端口</span><br><span class="line">-p 10241:50000 将镜像的50000端口映射到服务器的10241端口</span><br><span class="line">-v  /www/jenkins_home:/var/jenkins_home目录为容器jenkins工作目录，咱们将硬盘上的一个目录挂载到这个地位，不便后续更新镜像后持续应用原来的工作目录。这里咱们设置的就是下面咱们创立的 /var/jenkins_home目录</span><br><span class="line">--name定义一个容器的名字，如果没有指定，那么会主动生成一个随机数字符串当做UUID</span><br></pre></td></tr></table></figure>

<h3 id=""><a href="#" class="headerlink" title=""></a><img src="/../images/jenkins/Snipaste_2023-02-24_12-22-27.png" alt="Snipaste_2023-02-24_12-22-27"></h3><h3 id="5-搭建成功"><a href="#5-搭建成功" class="headerlink" title="5. 搭建成功"></a>5. 搭建成功</h3><p><img src="/../images/jenkins/Snipaste_2023-02-24_12-24-22.png" alt="Snipaste_2023-02-24_12-24-22"></p>
<p>到这里后有个密码是要输入的，通过以下命令获取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs jenkins</span><br></pre></td></tr></table></figure>

<p><img src="/../images/jenkins/Snipaste_2023-02-24_12-27-14.png" alt="Snipaste_2023-02-24_12-27-14"></p>
<p><strong>接着到新手入门界面</strong></p>
<ol>
<li>选择安装推荐的插件</li>
<li>创建第一个管理员用户，自己创建用户名和密码即可</li>
<li>实例配置的URL可以不用改，默认即可</li>
<li>保存并完成</li>
<li>点击重启按钮</li>
</ol>
<h3 id="6-配置插件"><a href="#6-配置插件" class="headerlink" title="6. 配置插件"></a>6. 配置插件</h3><p>进入Jenkins，在系统管理中安装插件，安装插件 <strong>NodeJS</strong> 、<strong>Publish Over SSH</strong> </p>
<p><img src="/../images/jenkins/Snipaste_2023-02-24_12-52-34.png" alt="Snipaste_2023-02-24_12-52-34"></p>
<h3 id="7-添加凭据"><a href="#7-添加凭据" class="headerlink" title="7. 添加凭据"></a>7. 添加凭据</h3><p><img src="/../images/jenkins/Snipaste_2023-02-24_12-56-34.png" alt="Snipaste_2023-02-24_12-56-34"></p>
<p><img src="/../images/jenkins/Snipaste_2023-02-24_12-58-14.png" alt="Snipaste_2023-02-24_12-58-14"></p>
<p><img src="/../images/jenkins/Snipaste_2023-02-24_12-58-53.png" alt="Snipaste_2023-02-24_12-58-53"></p>
<p><img src="/../images/jenkins/Snipaste_2023-02-24_13-03-27.png" alt="Snipaste_2023-02-24_13-03-27"></p>
<p><img src="/../images/jenkins/Snipaste_2023-02-24_13-03-00.png" alt="Snipaste_2023-02-24_13-03-00"></p>
<h3 id="8-全局工具配置"><a href="#8-全局工具配置" class="headerlink" title="8. 全局工具配置"></a>8. 全局工具配置</h3><p><img src="/../images/jenkins/Snipaste_2023-02-24_13-04-55.png" alt="Snipaste_2023-02-24_13-04-55"></p>
<p><img src="/../images/jenkins/Snipaste_2023-02-24_13-05-52.png" alt="Snipaste_2023-02-24_13-05-52"></p>
<p><img src="/../images/jenkins/Snipaste_2023-02-24_13-07-59.png" alt="Snipaste_2023-02-24_13-07-59"></p>
<p><strong>然后点击应用、保存按钮</strong></p>
<h3 id="9-系统配置ssh"><a href="#9-系统配置ssh" class="headerlink" title="9. 系统配置ssh"></a>9. 系统配置ssh</h3><p><img src="/../images/jenkins/Snipaste_2023-02-24_13-10-25.png" alt="Snipaste_2023-02-24_13-10-25"></p>
<p><img src="/../images/jenkins/Snipaste_2023-02-24_13-17-06.png" alt="Snipaste_2023-02-24_13-17-06"></p>
<p><strong>然后点击应用、保存按钮</strong></p>
<h3 id="10-新建任务（项目自动部署）"><a href="#10-新建任务（项目自动部署）" class="headerlink" title="10. 新建任务（项目自动部署）"></a>10. 新建任务（项目自动部署）</h3><p><img src="/../images/jenkins/Snipaste_2023-02-24_13-19-54.png" alt="Snipaste_2023-02-24_13-19-54"></p>
<p><img src="/../images/jenkins/Snipaste_2023-02-24_13-20-54.png" alt="Snipaste_2023-02-24_13-20-54"></p>
<p><img src="/../images/jenkins/Snipaste_2023-02-24_13-26-12.png" alt="Snipaste_2023-02-24_13-26-12"></p>
<p><img src="/../images/jenkins/Snipaste_2023-02-24_13-33-40.png" alt="Snipaste_2023-02-24_13-33-40"></p>
<p><img src="/../images/jenkins/Snipaste_2023-02-24_13-42-19.png" alt="Snipaste_2023-02-24_13-42-19"></p>
<p><img src="/../images/jenkins/Snipaste_2023-02-24_13-44-41.png" alt="Snipaste_2023-02-24_13-44-41"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;开始构建&quot;</span><br><span class="line">node -v</span><br><span class="line">npm -v</span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line">cnpm install</span><br><span class="line">npm run build</span><br><span class="line">#进入到打包目录</span><br><span class="line">cd dist</span><br><span class="line">#删除上次打包生成的压缩文件</span><br><span class="line">rm -rf *.tar.gz</span><br><span class="line">#把生成的项目打包成压缩包方便传输到远程服务器</span><br><span class="line">tar -zcvf `date +%Y-%m-%d-%H-%M-%S`.tar.gz *</span><br><span class="line">#回到上层工作目录</span><br><span class="line">cd ../</span><br><span class="line">echo &quot;构建结束&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/../images/jenkins/Snipaste_2023-02-24_14-07-41.png" alt="Snipaste_2023-02-24_14-07-41"></p>
<p>然后点击应用、保存按钮 –&gt;此刻基本就搭建完成了，接下来去构建项目</p>
<p><img src="/../images/jenkins/Snipaste_2023-02-24_14-11-12.png" alt="Snipaste_2023-02-24_14-11-12"></p>
<p><img src="/../images/jenkins/Snipaste_2023-02-24_14-10-15.png" alt="Snipaste_2023-02-24_14-10-15"></p>
<p><img src="/../images/jenkins/Snipaste_2023-02-24_13-57-46.png" alt="Snipaste_2023-02-24_13-57-46"></p>
<p><strong>大功告成~~~</strong></p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-02-24</span><i class="fa fa-tag"></i><a class="tag" href="/tags/Jenkins/" title="Jenkins">Jenkins </a><span class="leancloud_visitors"></span><span>大约553个字, 1分钟50秒读完</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/02/11/peng-cli/">peng-cli（脚手架工具）</a></h3></div><div class="post-content"><div class="card"><p><p>npm包地址: <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/peng-cli">https://www.npmjs.com/package/peng-cli</a></p>
<h3 id="1-基本架构"><a href="#1-基本架构" class="headerlink" title="1. 基本架构"></a><strong>1. 基本架构</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- lib</span><br><span class="line">	- config</span><br><span class="line">		- constants  // 常量</span><br><span class="line">		- repoMap    // 仓库地址的映射</span><br><span class="line">	- core</span><br><span class="line">		- commands   // 命令遍历</span><br><span class="line">		- create     // create命令执行逻辑</span><br><span class="line">		- help		 // --help命令执行逻辑</span><br><span class="line">- index				 // 入口</span><br><span class="line">- package.json</span><br></pre></td></tr></table></figure>

<p>所需依赖</p>
<ul>
<li>commander：命令行操作</li>
<li>download-git-repo：用于下载仓库</li>
<li>inquirer@8：交互</li>
<li>ora@4：可视加载</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i commander download-git-repo inquirer@8 ora@4</span><br></pre></td></tr></table></figure>

<p>注意下载的版本，因为inquirer@8和ora@4才支持<code>CommanJs</code></p>
<h3 id="2-基本配置"><a href="#2-基本配置" class="headerlink" title="2. 基本配置"></a>2. 基本配置</h3><ol>
<li><code>npm init -y</code>初始化</li>
<li>进入<code>package.json</code>需要进行一些配置：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./index.js&quot;</span><span class="punctuation">,</span>  <span class="comment">// 入口文件</span></span><br><span class="line">  <span class="attr">&quot;bin&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;peng-cli&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./index.js&quot;</span>  <span class="comment">// 通过执行`peng-cli`可执行对应的文件</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>进入<code>index.js</code>文件，声明执行环境</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;peng-cli&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>全局链接命令</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm link</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>尝试执行，此时终端会打印出okk</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peng-cli</span><br></pre></td></tr></table></figure>

<h3 id="3-命令与文件说明"><a href="#3-命令与文件说明" class="headerlink" title="3. 命令与文件说明"></a>3. 命令与文件说明</h3><p><strong>version与help</strong></p>
<p><code>lib/config/constants.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 01 获取版本信息</span></span><br><span class="line"><span class="keyword">const</span> &#123; version &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../../package.json&#x27;</span>)  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 02 配置所有需要的命令。写法是commander规定的，具体可在官网查看</span></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">    <span class="attr">create</span>: &#123;  <span class="comment">// create 命令，会通过`peng-cli create`执行</span></span><br><span class="line">       <span class="attr">alias</span>: <span class="string">&quot;c&quot;</span>, <span class="comment">// 别名</span></span><br><span class="line">       <span class="attr">description</span>: <span class="string">&quot;create a project&quot;</span>, <span class="comment">//描述</span></span><br><span class="line">       <span class="attr">examples</span>: [<span class="string">&quot;peng-cli create &lt;project-name&gt;&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;*&quot;</span>: &#123;     <span class="comment">// 其他没有被匹配的命令</span></span><br><span class="line">       <span class="attr">alias</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">       <span class="attr">description</span>: <span class="string">&quot;command not found&quot;</span>,</span><br><span class="line">       <span class="attr">examples</span>: [],</span><br><span class="line">    &#125;,</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>=&#123;</span><br><span class="line">    version,</span><br><span class="line">    actions</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>lib/core/help.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> program = <span class="built_in">require</span>(<span class="string">&#x27;commander&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; actions &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../config/constants&#x27;</span>)  <span class="comment">// 导入所有注册的命令</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">helpOptions</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    program.<span class="title function_">on</span>(<span class="string">&quot;--help&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\nExamples:&quot;</span>)			      <span class="comment">// 依次遍历打印所有命令的例子</span></span><br><span class="line">        <span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(actions).<span class="title function_">forEach</span>(<span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">            actions[action].<span class="property">examples</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">example</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(example)</span><br><span class="line">           &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">     &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = helpOptions</span><br></pre></td></tr></table></figure>

<p><code>index.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> program = <span class="built_in">require</span>(<span class="string">&#x27;commander&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> helpOptions = <span class="built_in">require</span>(<span class="string">&#x27;./lib/core/help&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; version &#125; = <span class="built_in">require</span>(<span class="string">&quot;./lib/config/constants&quot;</span>)</span><br><span class="line"></span><br><span class="line">program.<span class="title function_">version</span>(version,<span class="string">&#x27;-v,--version&#x27;</span>) <span class="comment">//设置版本命令</span></span><br><span class="line"><span class="title function_">helpOptions</span>() <span class="comment">// 设置help命令</span></span><br><span class="line"></span><br><span class="line">program.<span class="title function_">parse</span>(process.<span class="property">argv</span>);   <span class="comment">// 最后需要执行下这条才会生效（！）</span></span><br></pre></td></tr></table></figure>

<p>尝试一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">peng-cli -v</span><br><span class="line">peng-cli --help</span><br></pre></td></tr></table></figure>

<h3 id="4-注册所有命令"><a href="#4-注册所有命令" class="headerlink" title="4. 注册所有命令"></a>4. 注册所有命令</h3><p>在上面已经写过<code>actions</code>常量了，现在根据常量注册一下所有命令。</p>
<p><code>lib/core/commands.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;actions&#125; = <span class="built_in">require</span>(<span class="string">&#x27;../config/constants&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> program = <span class="built_in">require</span>(<span class="string">&#x27;commander&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">commands</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">   <span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(actions).<span class="title function_">forEach</span>(<span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">      program</span><br><span class="line">         .<span class="title function_">command</span>(action) <span class="comment">// 配置命令名称</span></span><br><span class="line">         .<span class="title function_">alias</span>(actions[action].<span class="property">alias</span>) <span class="comment">// 配置命令别名</span></span><br><span class="line">         .<span class="title function_">description</span>(actions[action].<span class="property">description</span>) <span class="comment">// 配置命令描述</span></span><br><span class="line">         .<span class="title function_">action</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (action === <span class="string">&quot;*&quot;</span>) &#123;</span><br><span class="line">               <span class="variable language_">console</span>.<span class="title function_">log</span>(actions[action].<span class="property">description</span>) <span class="comment">// 匹配不到时</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="comment">// 匹配到命令时，获取对应的文件（该文件返回一个函数），并执行该函数</span></span><br><span class="line">               <span class="comment">// 假设action为create，那么下面的操作就是去导入create.js的函数，并执行它</span></span><br><span class="line">                </span><br><span class="line">               <span class="comment">// 简单说明一下process.argv的结构：</span></span><br><span class="line">               <span class="comment">// [node可执行文件的绝对路径,当前执行文件的路径,其他参数]</span></span><br><span class="line">               <span class="comment">// 现在具体到 peng-cli create myproject，</span></span><br><span class="line">               <span class="comment">// （由于前面在package.json进行了配置，其实node就可忽略，peng-cli代表的就是index.js)</span></span><br><span class="line">               <span class="comment">//  翻译一下，实际执行的是：node index.js create myproject</span></span><br><span class="line">               <span class="comment">// 所以process.argv的结构是：</span></span><br><span class="line">               <span class="comment">// [node， index.js， create， myproject]</span></span><br><span class="line">               <span class="comment">// 现在通过.slice(3)剔除掉前面三个后就是[myproject]</span></span><br><span class="line">               <span class="comment">// 最后再解构一下，传入的就是 myproject，也就是写入的项目名称</span></span><br><span class="line">               <span class="built_in">require</span>(path.<span class="title function_">resolve</span>(__dirname, action))(...process.<span class="property">argv</span>.<span class="title function_">slice</span>(<span class="number">3</span>))</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;)</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = commands</span><br></pre></td></tr></table></figure>

<p>现在回到入口文件注册一下：</p>
<p><code>index.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">const</span> commands = <span class="built_in">require</span>(<span class="string">&#x27;./lib/core/commands&#x27;</span>)</span><br><span class="line"><span class="title function_">commands</span>()</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">program.<span class="title function_">parse</span>(process.<span class="property">argv</span>);</span><br></pre></td></tr></table></figure>

<p><strong>create</strong></p>
<p>现在就是写create命令的逻辑了。</p>
<p>下载仓库当然要下载地址，关于下载地址的写法可参考<code>download-git-repo</code>官网，我这边采用<code>direct</code>方式。</p>
<p>由于我提供了交互，我将根据交互结果为用户提供指定的模板。</p>
<p><img src="/../images/npm/Snipaste_2023-02-24_15-24-25.png" alt="Snipaste_2023-02-24_15-24-25"></p>
<p>点进某个仓库之后，我需要的地址如图所示：</p>
<p><img src="/../images/npm/Snipaste_2023-02-24_15-26-41.png" alt="Snipaste_2023-02-24_15-26-41"></p>
<p>知道自己的地址结构后，就可以安心地写映射了：</p>
<p><code>lib/config/repoMap.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getReportUrl</span> = (<span class="params">name</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (name === <span class="string">&#x27;vue-ts-nuxt3&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`github:AnderPeng/Nuxt3-ArcoDesign#main`</span> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 由于是根据用户的交互结果来下载某个模板的</span></span><br><span class="line"><span class="comment">// 前面的key就是用户交互的结果，我要根据答案给用户提供模板</span></span><br><span class="line"><span class="comment">// 我这边设置的是：</span></span><br><span class="line"><span class="comment">// - 选择框架： 1|Vue 2|React</span></span><br><span class="line"><span class="comment">// - 选择语言： 1|JavaScript  2|TypeScript</span></span><br><span class="line"><span class="comment">// - 选择模板： 1|Nuxt3  2|admin</span></span><br><span class="line"><span class="comment">// 这个比较灵活，根据自身需求写就行</span></span><br><span class="line"><span class="keyword">const</span> repoMap = &#123;</span><br><span class="line">    <span class="string">&#x27;111&#x27;</span>: <span class="title function_">getReportUrl</span>(<span class="string">&#x27;vue-js-nuxt3&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;112&#x27;</span>: <span class="title function_">getReportUrl</span>(<span class="string">&#x27;vue-js-admin&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;121&#x27;</span>: <span class="title function_">getReportUrl</span>(<span class="string">&#x27;vue-ts-nuxt3&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;122&#x27;</span>: <span class="title function_">getReportUrl</span>(<span class="string">&#x27;vue-ts-admin&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;211&#x27;</span>: <span class="title function_">getReportUrl</span>(<span class="string">&#x27;react-js-nuxt3&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;212&#x27;</span>: <span class="title function_">getReportUrl</span>(<span class="string">&#x27;react-js-admin&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;221&#x27;</span>: <span class="title function_">getReportUrl</span>(<span class="string">&#x27;react-ts-nuxt3&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;222&#x27;</span>: <span class="title function_">getReportUrl</span>(<span class="string">&#x27;react-ts-admin&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = repoMap</span><br></pre></td></tr></table></figure>

<p><code>lib/core/create.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; promisify &#125; = <span class="built_in">require</span>(<span class="string">&quot;util&quot;</span>)  <span class="comment">// 转为异步</span></span><br><span class="line"><span class="keyword">const</span> download = <span class="title function_">promisify</span>(<span class="built_in">require</span>(<span class="string">&quot;download-git-repo&quot;</span>))</span><br><span class="line"><span class="keyword">const</span> ora = <span class="built_in">require</span>(<span class="string">&#x27;ora&#x27;</span>) <span class="comment">// 可视加载</span></span><br><span class="line"><span class="keyword">const</span> inquirer = <span class="built_in">require</span>(<span class="string">&quot;inquirer&quot;</span>) <span class="comment">// 交互</span></span><br><span class="line"><span class="keyword">const</span> repoMap = <span class="built_in">require</span>(<span class="string">&quot;../config/repoMap&quot;</span>) <span class="comment">// 仓库地址映射</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 询问1：选择框架</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useFrame</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> inquirer.<span class="title function_">prompt</span>([</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;list&quot;</span>,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;frame&quot;</span>,  <span class="comment">// 交互结果会放在这个字段中</span></span><br><span class="line">            <span class="attr">message</span>: <span class="string">&quot;chose frame：&quot;</span>,</span><br><span class="line">            <span class="attr">default</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">choices</span>: [</span><br><span class="line">                &#123; <span class="attr">value</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;Vue&quot;</span> &#125;,</span><br><span class="line">                &#123; <span class="attr">value</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;React&quot;</span> &#125;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;</span><br><span class="line">    ])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 询问2：选择语言</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useLang</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> inquirer.<span class="title function_">prompt</span>([</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;list&quot;</span>,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;lang&quot;</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&quot;chose lang：&quot;</span>,</span><br><span class="line">            <span class="attr">default</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">choices</span>: [</span><br><span class="line">                &#123; <span class="attr">value</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;JavaScript&quot;</span> &#125;,</span><br><span class="line">                &#123; <span class="attr">value</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;TypeScript&quot;</span> &#125;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;</span><br><span class="line">    ])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 询问3：选择模板</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useTemplate</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> inquirer.<span class="title function_">prompt</span>([</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;list&quot;</span>,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;template&quot;</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&quot;chose template&quot;</span>,</span><br><span class="line">            <span class="attr">default</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">choices</span>: [</span><br><span class="line">                &#123; <span class="attr">value</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;Nuxt3&quot;</span> &#125;,</span><br><span class="line">                &#123; <span class="attr">value</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;admin&quot;</span> &#125;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;</span><br><span class="line">    ])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getResult</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 当使用框架时，让用户选择</span></span><br><span class="line">    <span class="keyword">const</span> frame = <span class="keyword">await</span> <span class="title function_">useFrame</span>()</span><br><span class="line">    <span class="keyword">const</span> lang = <span class="keyword">await</span> <span class="title function_">useLang</span>()</span><br><span class="line">    <span class="keyword">const</span> template = <span class="keyword">await</span> <span class="title function_">useTemplate</span>()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;frame.frame&#125;</span><span class="subst">$&#123;lang.lang&#125;</span><span class="subst">$&#123;template.template&#125;</span>`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createProjectAction</span> = <span class="keyword">async</span> (<span class="params">projectName</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">getResult</span>()</span><br><span class="line">    <span class="keyword">const</span> spinner = <span class="title function_">ora</span>(<span class="string">&#x27;Fetch...&#x27;</span>).<span class="title function_">start</span>(); <span class="comment">// 开始可视加载</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;下载地址&#x27;</span>, repoMap[result]);</span><br><span class="line">    <span class="comment">// 传入仓库地址，项目名称，配置</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">download</span>(repoMap[result], projectName).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        spinner.<span class="title function_">succeed</span>(<span class="string">&quot;success!&quot;</span>)			<span class="comment">// 结束可视加载</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`- cd <span class="subst">$&#123;projectName&#125;</span>`</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;- npm install     -- to install dependencies&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;- npm start       -- to run the project&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;- npm run build   -- to build the project&quot;</span>)</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;error&#x27;</span>, error);</span><br><span class="line">        spinner.<span class="title function_">fail</span>(<span class="string">&quot;error!&quot;</span>, error)			<span class="comment">// 结束可视加载</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = createProjectAction</span><br></pre></td></tr></table></figure>

<p>尝试一下~</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peng-cli create demo</span><br></pre></td></tr></table></figure>

</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-02-11</span><i class="fa fa-tag"></i><a class="tag" href="/tags/JavaScript/" title="JavaScript">JavaScript </a><span class="leancloud_visitors"></span><span>大约1501个字, 5分钟0秒读完</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/02/11/first-npm-package/">发布npm包（将脚手架工具上传到npm）</a></h3></div><div class="post-content"><div class="card"><p><h3 id="1-发布包"><a href="#1-发布包" class="headerlink" title="1. 发布包"></a>1. 发布包</h3><ol>
<li>先去官网注册一个账号(如果有账号，直接执行npm login)</li>
<li>执行如下命令</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry https://registry.npmjs.org  // 切换镜像</span><br><span class="line">npm adduser // 添加或验证用户</span><br><span class="line">username // 输入用户名 </span><br><span class="line">password // 输入密码（不要怀疑，在这里不管你有没有输入，光标都是不会动的，输入密码后按回车就可）</span><br><span class="line">email    // 输入邮箱</span><br><span class="line">code     // 邮箱会接收一个一次性密码，输入即可</span><br><span class="line"></span><br><span class="line">npm login  // 登录</span><br><span class="line">npm adduser // 忘记要不要输入这个了 看着来</span><br><span class="line">username</span><br><span class="line">password</span><br><span class="line">email</span><br><span class="line">code</span><br><span class="line"></span><br><span class="line">npm publish  // 发布，如果有问题，就换个名称，在package.json中修改name</span><br><span class="line">npm config set registry http://registry.npm.taobao.org/ // 最后记得切换回来</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>最后记得保存好自己的npm包</li>
</ol>
<h3 id="2-更新包"><a href="#2-更新包" class="headerlink" title="2. 更新包"></a>2. 更新包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm version &lt;update_type&gt;  // 类型有：major minor patch </span><br><span class="line">npm publish</span><br></pre></td></tr></table></figure>

</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-02-11</span><i class="fa fa-tag"></i><a class="tag" href="/tags/npm/" title="npm">npm </a><span class="leancloud_visitors"></span><span>大约213个字, 42秒读完</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/02/05/wx-login/">PC端微信扫码登录(二维码内嵌)</a></h3></div><div class="post-content"><div class="card"><p><p>利用iframe通信完成PC微信扫码登录</p>
<h3 id="1-先在index-html中引入js文件"><a href="#1-先在index-html中引入js文件" class="headerlink" title="1.先在index.html中引入js文件"></a>1.先在index.html中引入js文件</h3><p><img src="/../images/wxlogn/Snipaste_2023-02-23_13-39-43.png" alt="Snipaste_2023-02-23_13-39-43"></p>
<h3 id="2-在需要的页面进行实例化"><a href="#2-在需要的页面进行实例化" class="headerlink" title="2.在需要的页面进行实例化"></a>2.在需要的页面进行实例化</h3><p><img src="/../images/wxlogn/Snipaste_2023-02-23_13-42-30.png" alt="Snipaste_2023-02-23_13-42-30"></p>
<ul>
<li><strong>2.1 封装登录弹窗组件(login.vue)—根据业务需求，不封装直接在页面使用也可以</strong></li>
</ul>
<p><img src="/../images/wxlogn/Snipaste_2023-02-23_14-12-22.png" alt="Snipaste_2023-02-23_14-12-22"></p>
<p><img src="/../images/wxlogn/Snipaste_2023-02-23_14-09-46.png" alt="Snipaste_2023-02-23_14-09-46"></p>
<p>键值说明：<br>Id: 是存放二维码的容器，<br>appid: 是开发者在微信开房平台提交申请后，获得appid和一个秘钥<br>scope: snsapi_login这个是代表网页版<br>redirect_uri: 这个是扫码后要跳转的页面，这个是要跳转到code页面，这个路径要urlEncode转码的，转码地址为（<a target="_blank" rel="noopener" href="http://tool.phpshuo.com/UrlEncode.html%EF%BC%89">http://tool.phpshuo.com/UrlEncode.html）</a>, 注意，要跳转的地址必须在申请的域名下面。<br>style: 代表二维码的样式，有black和white可选，<br>href: 修改二维码的样式，要经过base64位转码，地址为（<a target="_blank" rel="noopener" href="https://the-x.cn/base64/%EF%BC%89%E4%B9%9F%E5%8F%AF%E4%BB%A5%E6%98%AF%E9%93%BE%E6%8E%A5%E5%9C%B0%E5%9D%80%E3%80%82">https://the-x.cn/base64/）也可以是链接地址。</a></p>
<ul>
<li><strong>2.2 回调地址的code.vue页面</strong></li>
</ul>
<p><img src="/../images/wxlogn/Snipaste_2023-02-23_14-19-33.png" alt="Snipaste_2023-02-23_14-19-33"></p>
<ul>
<li><p><strong>2.3 在需要登录的页面使用login组件&amp;注册事件接收iframe发送的数据</strong></p>
<p>监听事件：如果code&amp;state有值，那么代表用户扫码成功，接下来就可以做逻辑处理了</p>
</li>
</ul>
<p><img src="/../images/wxlogn/Snipaste_2023-02-23_14-28-22.png" alt="Snipaste_2023-02-23_14-28-22"></p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-02-05</span><i class="fa fa-tag"></i><a class="tag" href="/tags/Vue3/" title="Vue3">Vue3 </a><span class="leancloud_visitors"></span><span>大约313个字, 1分钟2秒读完</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2022/12/01/vue2-vue3/">Vue2和Vue3的区别</a></h3></div><div class="post-content"><div class="card"><p><h3 id="1、-Vue2-0-和-Vue3-0-有什么区别？"><a href="#1、-Vue2-0-和-Vue3-0-有什么区别？" class="headerlink" title="1、 Vue2.0 和 Vue3.0 有什么区别？"></a>1、 Vue2.0 和 Vue3.0 有什么区别？</h3><ol>
<li>响应式系统的重新配置，使用代理替换对象.define属性，使用代理优势：</li>
</ol>
<ul>
<li><p>可直接监控阵列类型的数据变化</p>
</li>
<li><p>监听的目标是对象本身，不需要像Object.defineProperty那样遍历每个属性，有一定的性能提升</p>
</li>
<li><p>可拦截应用、拥有密钥、有等13种方法，以及Object.define属性没有办法</p>
</li>
<li><p>直接添加对象属性&#x2F;删除</p>
</li>
</ul>
<ol start="2">
<li><p>新增组合API，更好的逻辑重用和代码组织</p>
</li>
<li><p>重构虚拟 DOM</p>
</li>
</ol>
<ul>
<li><p>模板编译时间优化，将一些静态节点编译成常量</p>
</li>
<li><p>slot优化，采取槽编译成懒人功能，拿槽渲染的决定留给子组件</p>
</li>
<li><p>在模板中提取和重用内联事件（最初，每次渲染时都会重新生成内联函数）</p>
</li>
</ul>
<ol start="4">
<li><p>代码结构调整，更方便树摇动，使其更小</p>
</li>
<li><p>使用打字脚本替换流</p>
</li>
</ol>
<h3 id="2、Vue3带来了什么改变？"><a href="#2、Vue3带来了什么改变？" class="headerlink" title="2、Vue3带来了什么改变？"></a>2、Vue3带来了什么改变？</h3><ol>
<li>性能的提升</li>
</ol>
<ul>
<li><p>打包大小减少41%</p>
</li>
<li><p>初次渲染快55%, 更新渲染快133%</p>
</li>
<li><p>内存减少54%</p>
</li>
</ul>
<ol start="2">
<li>源码的升级</li>
</ol>
<ul>
<li><p>使用Proxy代替<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=defineProperty&spm=1001.2101.3001.7020">defineProperty</a>实现响应式</p>
</li>
<li><p>重写<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E8%99%9A%E6%8B%9FDOM&spm=1001.2101.3001.7020">虚拟DOM</a>的实现和Tree-Shaking</p>
</li>
</ul>
<ol start="3">
<li>拥抱TypeScript</li>
</ol>
<ul>
<li>Vue3可以更好的支持TypeScript</li>
</ul>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-12-01</span><i class="fa fa-tag"></i><a class="tag" href="/tags/Vue/" title="Vue">Vue </a><span class="leancloud_visitors"></span><span>大约332个字, 1分钟6秒读完</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2022/11/11/next3-arcoDesign/">Nuxt3搭建官网</a></h3></div><div class="post-content"><div class="card"><p><h3 id="1-Nuxt3的安装"><a href="#1-Nuxt3的安装" class="headerlink" title="1. Nuxt3的安装"></a>1. Nuxt3的安装</h3><p>前提，确保有Nuxt3的安装环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Node.js（必要）</span><br><span class="line">Visual Studio Code（推荐）</span><br><span class="line">Volar（推荐）</span><br></pre></td></tr></table></figure>

<p>node.js 版本之间有差异，安装Nuxt3目前官方推荐 v14 和 v16，或更高的版本。</p>
<h3 id="1-1-安装新建-Nuxt3-项目"><a href="#1-1-安装新建-Nuxt3-项目" class="headerlink" title="1.1. 安装新建 Nuxt3 项目"></a>1.1. 安装新建 Nuxt3 项目</h3><p>首先在你的Nuxt3工作空间下新建一个Nuxt3项目,打开终端输入下方命令</p>
<h6 id="npx-安装"><a href="#npx-安装" class="headerlink" title="npx 安装"></a>npx 安装</h6><p><code>npx</code> 是 <code>npm5.2</code> 之后发布的一个命令，可以代替 <code>npm</code> 命令安装依赖或包。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx nuxi init nuxt-app   # nuxt-app 是项目名</span><br></pre></td></tr></table></figure>

<img src="../images/Snipaste_2022-11-13_18-35-36.png" alt="Snipaste_2022-11-13_18-35-36" style="zoom: 50%;" />

<h3 id="1-2-Nuxt3-运行端口"><a href="#1-2-Nuxt3-运行端口" class="headerlink" title="1.2. Nuxt3 运行端口"></a>1.2. Nuxt3 运行端口</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 进入nuxt-app项目，安装依赖</span><br><span class="line">cd nuxt-app</span><br><span class="line"># npm</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>

<img src="../images/Snipaste_2022-11-13_18-40-49.png" alt="Snipaste_2022-11-13_18-40-49" style="zoom:50%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 启动项目</span><br><span class="line"># npm</span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<img src="../images/Snipaste_2022-11-13_18-43-32.png" alt="Snipaste_2022-11-13_18-43-32" style="zoom:50%;" />

<p>访问：<a target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000/</a></p>
<img src="../images/Snipaste_2022-11-13_18-45-15.png" alt="Snipaste_2022-11-13_18-45-15" style="zoom: 25%;" />

<p>目前为止，我们就可以开始开发Nuxt3项目啦。</p>
<h1 id="2-arco-design的安装配置"><a href="#2-arco-design的安装配置" class="headerlink" title="2. arco-design的安装配置"></a>2. arco-design的安装配置</h1><h3 id="2-1-完整引入"><a href="#2-1-完整引入" class="headerlink" title="2.1. 完整引入"></a>2.1. 完整引入</h3><p>vue &gt;&#x3D; 3.2.0</p>
<p><strong>注意</strong>：由于 <code>Vue3</code> 不再支持 IE 浏览器环境，ArcoVue 也不再支持 IE 浏览器环境。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># npm</span><br><span class="line">npm install --save-dev @arco-design/web-vue</span><br><span class="line"># yarn</span><br><span class="line">yarn add --dev @arco-design/web-vue</span><br></pre></td></tr></table></figure>

<p>因为 <code>arco-design</code> 属于第三方插件，需要在 <code>plugins</code> 目录配置</p>
<p>根目录下新建 <code>plugins</code> 目录， 在目录下新建 <code>arco-design.ts</code> 文件（注意：默认必须在 <code>plugins</code> 下新建配置文件，这是“约定”，详情见<a target="_blank" rel="noopener" href="https://v3.nuxtjs.org/">官网</a>）</p>
<p>在 <code>plugins/arco-design.ts</code> 中配置全局</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineNuxtPlugin &#125; <span class="keyword">from</span> <span class="string">&#x27;#app&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ArcoVue</span> <span class="keyword">from</span> <span class="string">&#x27;@arco-design/web-vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineNuxtPlugin</span>(<span class="function"><span class="params">nuxtApp</span> =&gt;</span> &#123;</span><br><span class="line">    nuxtApp.<span class="property">vueApp</span>.<span class="title function_">use</span>(<span class="title class_">ArcoVue</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>在 <code>nuxt.config.ts</code> 中全局配置样式 <code>css</code> 的位置</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://v3.nuxtjs.org/api/configuration/nuxt.config</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineNuxtConfig</span>(&#123;</span><br><span class="line">    <span class="attr">css</span>: [</span><br><span class="line">        <span class="string">&#x27;@arco-design/web-vue/dist/arco.css&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="../images/Snipaste_2022-11-13_19-00-58.png" alt="Snipaste_2022-11-13_19-00-58" style="zoom: 50%;" />

<h3 id="2-2-按需加载（模板）"><a href="#2-2-按需加载（模板）" class="headerlink" title="2.2. 按需加载（模板）"></a>2.2. 按需加载（模板）</h3><p>如果使用模板方式进行开发，可以使用 <a target="_blank" rel="noopener" href="https://github.com/antfu/unplugin-vue-components">unplugin-vue-components</a> 和 <a target="_blank" rel="noopener" href="https://github.com/antfu/unplugin-auto-import">unplugin-auto-import</a> 这两款插件来开启按需加载及自动导入的支持。<br>插件会自动解析模板中的使用到的组件，并导入组件和对应的样式文件。<br>需要组件库 <code>version &gt;= 2.11.0</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># npm</span><br><span class="line">npm install --save-dev unplugin-auto-import</span><br><span class="line">npm install --save-dev unplugin-vue-components</span><br></pre></td></tr></table></figure>

<p>在 <code>nuxt.config.ts</code> 中配置</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://v3.nuxtjs.org/api/configuration/nuxt.config</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">AutoImport</span> <span class="keyword">from</span> <span class="string">&#x27;unplugin-auto-import/vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Components</span> <span class="keyword">from</span> <span class="string">&#x27;unplugin-vue-components/vite&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ArcoResolver</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;unplugin-vue-components/resolvers&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineNuxtConfig</span>(&#123;</span><br><span class="line">    <span class="attr">app</span>: &#123;</span><br><span class="line">        <span class="attr">head</span>: &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;Nuxt3-ArcoDesign&#x27;</span>,</span><br><span class="line">            <span class="attr">meta</span>: [</span><br><span class="line">                &#123; <span class="attr">name</span>: <span class="string">&#x27;keywords&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;Nuxt3,arco-design&#x27;</span> &#125;,</span><br><span class="line">                &#123; <span class="attr">name</span>: <span class="string">&#x27;description&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;使用 Vue 3 构建您的下一个应用，体验混合渲染、强大的数据获取和新功能。 Nuxt 3 是一个开源框架，使 Web 开发变得简单而强大。&#x27;</span> &#125;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">vite</span>: &#123;</span><br><span class="line">        <span class="attr">plugins</span>: [</span><br><span class="line">            <span class="title class_">AutoImport</span>(&#123;</span><br><span class="line">                <span class="attr">resolvers</span>: [<span class="title class_">ArcoResolver</span>()],</span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="title class_">Components</span>(&#123;</span><br><span class="line">                <span class="attr">resolvers</span>: [</span><br><span class="line">                    <span class="title class_">ArcoResolver</span>(&#123;</span><br><span class="line">                        <span class="attr">sideEffect</span>: <span class="literal">true</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                ]</span><br><span class="line">            &#125;)</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="2-3-演示使用"><a href="#2-3-演示使用" class="headerlink" title="2.3. 演示使用"></a>2.3. 演示使用</h3><p>打开 <code>app.vue</code> ，初始内容如下，<code>&lt;NuxtWelcome /&gt;</code> 是官方的欢迎页面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;NuxtWelcome /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>替换成使用 <code>arco-design</code> 的代码查看是否安装配置成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;a-space&gt;</span><br><span class="line">      &lt;a-button type=&quot;primary&quot;&gt;Primary&lt;/a-button&gt;</span><br><span class="line">      &lt;a-button&gt;Secondary&lt;/a-button&gt;</span><br><span class="line">      &lt;a-button type=&quot;dashed&quot;&gt;Dashed&lt;/a-button&gt;</span><br><span class="line">      &lt;a-button type=&quot;outline&quot;&gt;Outline&lt;/a-button&gt;</span><br><span class="line">      &lt;a-button type=&quot;text&quot;&gt;Text&lt;/a-button&gt;</span><br><span class="line">    &lt;/a-space&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p><code>npm run dev</code> 启动项目，访问 <a target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000/</a></p>
<img src="../images/Snipaste_2022-11-13_19-05-32.png" alt="Snipaste_2022-11-13_19-05-32" style="zoom: 50%;" />

<h3 id="3-1-更详细的配置可访问-https-github-com-AnderPeng-Nuxt3-ArcoDesign-查看"><a href="#3-1-更详细的配置可访问-https-github-com-AnderPeng-Nuxt3-ArcoDesign-查看" class="headerlink" title="3.1.更详细的配置可访问 https://github.com/AnderPeng/Nuxt3-ArcoDesign 查看"></a>3.1.更详细的配置可访问 <a target="_blank" rel="noopener" href="https://github.com/AnderPeng/Nuxt3-ArcoDesign">https://github.com/AnderPeng/Nuxt3-ArcoDesign</a> 查看</h3><ol>
<li>useFetch的请求封装</li>
<li>api的使用</li>
<li>layouts布局</li>
<li>composables的使用</li>
</ol>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-11-11</span><i class="fa fa-tag"></i><a class="tag" href="/tags/Nuxt3/" title="Nuxt3">Nuxt3 </a><span class="leancloud_visitors"></span><span>大约822个字, 2分钟44秒读完</span></div></div></div></div><div class="pagination"><ul class="clearfix"></ul></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script>(function(window){var INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(无标题)",},CONTENT_URL:"/content.json",};window.INSIGHT_CONFIG=INSIGHT_CONFIG})(window);</script><script src="/js/insight.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="想要查找什么..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div></body></html>